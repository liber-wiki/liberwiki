FROM node:20-alpine

WORKDIR /liberwiki-frontend

ARG NEXT_PUBLIC_LIBERWIKI__NAME
ARG NEXT_PUBLIC_LIBERWIKI__API__BASE_URL
ARG NEXT_PUBLIC_LIBERWIKI__LANGUAGE

ENV NEXT_PUBLIC_LIBERWIKI__NAME=$NEXT_PUBLIC_LIBERWIKI__NAME
ENV NEXT_PUBLIC_LIBERWIKI__API__BASE_URL=$NEXT_PUBLIC_LIBERWIKI__API__BASE_URL
ENV NEXT_PUBLIC_LIBERWIKI__LANGUAGE=$NEXT_PUBLIC_LIBERWIKI__LANGUAGE

COPY . /liberwiki-frontend/

RUN npm install --frozen-lockfile
RUN npm run build

ENV NODE_ENV=production

EXPOSE 3000

RUN chmod +x /liberwiki-frontend/entrypoint.sh
ENTRYPOINT ["/liberwiki-frontend/entrypoint.sh"]
